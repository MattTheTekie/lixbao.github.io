{"data": "# Linux\u5165\u4fb5\u6392\u67e5\u601d\u8def\n\n![image-20210702134811730](https://raw.githubusercontent.com/lixbao/PicGo/main/img/20210712233520.png)\n\n## 1.\u68c0\u6d4b\u7cfb\u7edf\u8d26\u53f7\u5b89\u5168\n\n### 1.1 \u7528\u6237\u6587\u4ef6\u4fe1\u606f/etc/passwd\n\n```shell \nroot:x:0:0:root:/root:/bin/bash\naccount:password:UID:GID:GECOS:directory:shell\n#\u7528\u6237\u540d\uff1a\u5bc6\u7801\uff1a\u7528\u6237ID\uff1a\u7ec4ID\uff1a\u7528\u6237\u8bf4\u660e\uff1a\u5bb6\u76ee\u5f55\uff1a\u767b\u9646\u4e4b\u540eshell\n```\n\n> \u6ce8\u610f\uff1a\u65e0\u5bc6\u7801\u53ea\u5141\u8bb8\u672c\u673a\u767b\u9646\uff0c\u8fdc\u7a0b\u4e0d\u5141\u8bb8\u767b\u9646\n\n### 1.2 \u5f71\u5b50\u6587\u4ef6\n\n```shell\nt:$6$oGs1PqhL2p3ZetrE$X7o7bzoouHQVSEmSgsYN5UD4.kMHx6qgbTqwNVC5oOAouXvcjQSt.Ft7ql1WpkopY0UV9ajBwUt1DpYxTCVvI/:16809:0:99999:7:::\n#\u7528\u6237\u540d\uff1a\u52a0\u5bc6\u5bc6\u7801\uff1a\u5bc6\u7801\u6700\u540e\u4e00\u6b21\u4fee\u6539\u65e5\u671f\uff1a\u4e24\u6b21\u5bc6\u7801\u7684\u4fee\u6539\u65f6\u95f4\u95f4\u9694\uff1a\u5bc6\u7801\u6709\u6548\u671f\uff1a\u5bc6\u7801\u4fee\u6539\u5230\u671f\u5230\u7684\u8b66\u544a\u5929\u6570\uff1a\u5bc6\u7801\u8fc7\u671f\u4e4b\u540e\u7684\u5bbd\u9650\u5929\u6570\uff1a\u8d26\u53f7\u5931\u6548\u65f6\u95f4\uff1a\u4fdd\u7559\n```\n\n> who\t\u67e5\u770b\u5f53\u524d\u767b\u5f55\u7528\u6237\uff08tty\u672c\u5730\u767b\u9646 pts\u8fdc\u7a0b\u767b\u5f55\uff09\n>\n> w\t\t\u67e5\u770b\u7cfb\u7edf\u4fe1\u606f\uff0c\u60f3\u77e5\u9053\u67d0\u4e00\u65f6\u523b\u7528\u6237\u7684\u884c\u4e3a\n>\n> uptime\t\u67e5\u770b\u767b\u9646\u591a\u4e45\u3001\u591a\u5c11\u7528\u6237\uff0c\u8d1f\u8f7d\n\n### 1.3 \u5165\u4fb5\u6392\u67e5\n\n+ **\u67e5\u8be2\u7279\u6743\u7528\u6237\uff08uid\u4e3a0\uff09**\n\n```shell \nawk -F: '$3==0{print $1}' /etc/passwd\n```\n\n+ **\u67e5\u8be2\u53ef\u4ee5\u8fdc\u7a0b\u767b\u5f55\u7684\u5e10\u53f7\u4fe1\u606f**\n\n```shell\nawk '/\\$1|\\$6/{print $1}' /etc/shadow\n```\n\n+ **\u9664root\u5e10\u53f7\u5916\uff0c\u5176\u4ed6\u5e10\u53f7\u662f\u5426\u5b58\u5728sudo\u6743\u9650\u3002**\u5982\u975e\u7ba1\u7406\u9700\u8981\uff0c\u666e\u901a\u5e10\u53f7\u5e94\u5220\u9664sudo\u6743\u9650\n\n```shell\nmore /etc/sudoers | grep -v \"^#\\|^$\" | grep \"ALL=(ALL) \"\n```\n\n+ **\u7981\u7528\u6216\u5220\u9664\u591a\u4f59\u53ca\u53ef\u7591\u7684\u5e10\u53f7**\n\n```shell\nusermod -L user\t#\u7981\u7528\u5e10\u53f7\uff0c\u5e10\u53f7\u65e0\u6cd5\u5f55\uff0c/etc/shadow\u7b2c\u4e8c\u680f\u4e3a!\u5f00\u5934\nuserdel user\t#\u5220\u9664user\u7528\u6237\nuserdel -r user\t#\u5c06\u5220\u9664user\u7528\u6237\uff0c\u5e76\u4e14\u5c06/home\u76ee\u5f55\u4e0b\u7684user\u76ee\u5f55\u4e00\u5e76\u5220\u9664\n```\n\n## 2.\u5386\u53f2\u547d\u4ee4\u67e5\u770b\n\n### 2.1 root \u7684\u5386\u53f2\u547d\u4ee4\n\n``` shell\nhistory\n```\n\n### 2.2 \u6253\u5f00/home\u5404\u5e10\u53f7\u76ee\u5f55\u4e0b\u7684.bash_history\uff0c\u67e5\u770b\u666e\u901a\u5e10\u53f7\u7684\u5386\u53f2\u547d\u4ee4\n\n+ \u5982\u679c\u7528\u6237\u7684\u9ed8\u8ba4shell \u662fbash\uff0c\u90a3\u4e48bash\u4f1a\u8bb0\u5f55\u7528\u6237\u7684\u9ed8\u8ba4\u5386\u53f2\u8bb0\u5f55\u3002\n\n+ ~/.bash_history\u8bb0\u5f55\u7684\u662f\u4e0a\u4e00\u6b21\u767b\u9646\u7cfb\u7edf\u6240\u6267\u884c\u8fc7\u7684\u547d\u4ee4\uff0c\u800c\u5f53\u524d\u767b\u9646\u8fd9\u4e00\u6b21\u5219\u4fdd\u5b58\u5728\u5185\u5b58\u7f13\u5b58\u4e2d\uff0c\u5f53\u7cfb\u7edf\u5173\u673a/\u91cd\u542f\u540e\u4f1a\u66f4\u65b0\u5230~/.bash_history\u6587\u4ef6\u4e2d\u3002\n\n### 2.3 \u5165\u4fb5\u6392\u67e5\n\n+ \u8fdb\u5165\u7528\u6237\u76ee\u5f55\u4e0b\n\n+ cat .bash_history >> history.txt\n\n### 2.4 \u5386\u53f2\u64cd\u4f5c\u547d\u4ee4\u6e05\u9664\n\n```shell\nhistory \u2013c \n#\u8be5\u547d\u4ee4\u5e76\u4e0d\u4f1a\u6e05\u695a\u4fdd\u5b58\u5728\u6587\u4ef6\u4e2d\u7684\u8bb0\u5f55\uff0c\u9700\u8981\u624b\u52a8\u5220\u9664~/.bash_history\u6587\u4ef6\u4e2d\u7684\u8bb0\u5f55\u3002\n```\n\n### 2.5 \u5386\u53f2\u547d\u4ee4\u4f18\u5316\u67e5\u770b\n\n+ \u589e\u52a0\u5386\u53f2\u547d\u4ee4\u67e5\u770b\u6761\u6570\u3001\u589e\u52a0\u663e\u793a\u767b\u9646\u7684IP\u548c\u6267\u884c\u547d\u4ee4\u7684\u65f6\u95f4\u4fe1\u606f\n\n+ \u4fdd\u5b581\u4e07\u6761\u547d\u4ee4\u914d\u7f6e\uff1a\n\n```shell\nsed -i 's/^HISTSIZE=1000/HISTSIZE=10000/g' /etc/profile\n```\n\n+ \u5728**/etc/profile**\u7684\u6587\u4ef6\u5c3e\u90e8\u6dfb\u52a0\u5982\u4e0b\u884c\u6570\u914d\u7f6e\u4fe1\u606f\uff1a\n\n```shell\n######jiagu history xianshi#########\nUSER_IP=`who -u am i 2>/dev/null | awk '{print $NF}' | sed -e 's/[()]//g'`\nif [ \"$USER_IP\" = \"\" ]\nthen\nUSER_IP=`hostname`\nfi\nexport HISTTIMEFORMAT=\"%F %T $USER_IP `whoami` \"\nshopt -s histappend\nexport PROMPT_COMMAND=\"history -a\"\n######### jiagu history xianshi ##########\n```\n\n+ **\u4f7f\u914d\u7f6e\u751f\u6548\uff1asource  /etc/profile**\n\n## 3.\u68c0\u67e5\u7aef\u53e3\u3001\u8fdb\u7a0b\n\n\u68c0\u67e5\u5f02\u5e38\u7aef\u53e3\u3001\u8fdb\u7a0b\n\n+ \u4f7f\u7528netstat \u7f51\u7edc\u8fde\u63a5\u547d\u4ee4\uff0c\u5206\u6790\u53ef\u7591\u7aef\u53e3\u3001IP\u3001PID\n\n+ netstat -antlp|more\n\n+ \u67e5\u770b\u4e0bpid\u6240\u5bf9\u5e94\u7684\u8fdb\u7a0b\u6587\u4ef6\u8def\u5f84\uff0c\u8fd0\u884cls -l /proc/$PID/exe\u6216file /proc/$PID/exe\uff08$PID \u4e3a\u5bf9\u5e94\u7684pid \u53f7\uff09\uff0c\u67e5\u770b\u542f\u52a8\u547d\u4ee4ps \u2013ef |grep $PID\uff08\u6548\u679c\u540c ps aux |grep $PID\uff09\n\n## 4.\u542f\u52a8\u9879\n\n> \u6709\u65f6\u6728\u9a6c\u6216\u8005\u75c5\u6bd2\u7b49\u811a\u672c\u4f1a\u9690\u85cf\u5728\u5f00\u673a\u542f\u52a8\u4e2d\uff0c\u800cLinux\u7684\u542f\u52a8\u9879\u662f\u53d6\u51b3\u4e8e\u5f53\u524d\u7528\u6237\u7684\u8fd0\u884c\u7ea7\u522b\u7684\u3002\n\n### 4.1 Linux\u7cfb\u7edf\u8fd0\u884c\u7ea7\u522b\n\n| \u8fd0\u884c\u7ea7\u522b | \u542b\u4e49                                                      |\n| -------- | --------------------------------------------------------- |\n| 0        | \u5173\u673a                                                      |\n| 1        | \u5355\u7528\u6237\u6a21\u5f0f\uff0c\u53ef\u4ee5\u60f3\u8c61\u4e3awindows\u7684\u5b89\u5168\u6a21\u5f0f\uff0c\u4e3b\u8981\u7528\u4e8e\u7cfb\u7edf\u4fee\u590d |\n| 2        | \u4e0d\u5b8c\u5168\u7684\u547d\u4ee4\u884c\u6a21\u5f0f\uff0c\u4e0d\u542bNFS\u670d\u52a1                           |\n| 3        | \u5b8c\u5168\u7684\u547d\u4ee4\u884c\u6a21\u5f0f\uff0c\u5c31\u662f\u6807\u51c6\u5b57\u7b26\u754c\u9762                        |\n| 4        | \u7cfb\u7edf\u4fdd\u7559                                                  |\n| 5        | \u56fe\u5f62\u6a21\u5f0f                                                  |\n| 6        | \u91cd\u542f\u52a8                                                    |\n\n+ \u8fd0\u884c\u7ea7\u522b\u547d\u4ee4 runlevel\n\n### 4.2\u5f00\u673a\u542f\u52a8\u914d\u7f6e\u6587\u4ef6\n\n```shell\n/etc/rc.local/\netc/rc.d/rc[0~6].d  #0~6 \u4ee3\u8868\u8fd0\u884c\u7ea7\u522b\n```\n\n> \u5f53\u9700\u8981\u5f00\u673a\u542f\u52a8\u811a\u672c\u65f6\uff0c\u505a\u6cd5\u662f\u5c06\u53ef\u6267\u884c\u811a\u672c\u4e22\u5728/etc/init.d\u76ee\u5f55\u4e0b\uff0c\u63a5\u7740\u5728/etc/rc.d/rc*.d\u4e2d\u5efa\u7acb\u8f6f\u94fe\u63a5\u5373\u53ef\u3002\n\n### 4.3 \u5165\u4fb5\u6392\u67e5\n\n+ \u542f\u52a8\u9879\u6587\u4ef6\n\n```shell\nls \u2013l /etc/rc.d/rc[0~6].d \n```\n\n## 5.\u68c0\u67e5\u7cfb\u7edf\u5b9a\u65f6\u4efb\u52a1\n\n> \u5165\u4fb5\u7cfb\u7edf\u7684\u9ed1\u5ba2\u4e00\u822c\u4f1a\u4f7f\u7528crontab\u521b\u5efa\u5b9a\u671f\u4efb\u52a1\uff0c\u5982\u5b9a\u671f\u4e0b\u8f7d\u6728\u9a6c\uff0c\u5b9a\u671f\u4e0b\u8f7d\u6316\u77ff\u75c5\u6bd2\uff0c\u5b9a\u671f\u8fdb\u884c\u5185\u7f51\u626b\u63cf\u7b49\u7b49\u3002\n\n```shell\ncrontab -l #\u5217\u51fa\u67d0\u4e2a\u7528\u6237cron\u670d\u52a1\u7684\u8be6\u7ec6\u5185\u5bb9\ncrontab -e #\u8fdb\u5165crontab\u4efb\u52a1\u7f16\u8f91\ncrontab -r #\u5220\u9664\u6240\u6709\u8ba1\u5212\u4efb\u52a1\n#\u4e0d\u540c\u7528\u6237\u7684crontab \u4efb\u52a1\u4fdd\u5b58\u5728/var/spool/cron/crontabs/\u7528\u6237\u540d \u6587\u4ef6\u8def\u5f84\u4e0b\n```\n\n> Linux \u7cfb\u7edf\u521b\u5efa\u5b9a\u65f6\u4efb\u52a1\u9664\u4e86crontab\u4e4b\u5916\uff0c\u8fd8\u6709\u4e00\u4e2a\u5de5\u5177\u662f**anacron**\u3002anacron\u662f\u4e00\u4e2a**\u5f02\u6b65\u5b9a\u65f6\u4efb\u52a1\u8c03\u5ea6\u5de5\u5177**\uff0c\u7528\u6765\u5f25\u8865crontab\u7684\u4e0d\u8db3\u3002\n\n\u4f7f\u7528\u6848\u4f8b\uff1a\n\n+ \u6bcf\u5929\u8fd0\u884c/home/backup.sh\u811a\u672c\uff1a\n\n```shell\nvi /etc/anacrontab #\u52a0\u5165\u5982\u4e0b\u5185\u5bb9\n@daily 10 example.daily /bin/bash /home/backup.sh\n#\u5f53\u673a\u5668\u5728backup.sh \u671f\u671b\u88ab\u8fd0\u884c\u65f6\u662f\u5173\u673a\u7684\uff0canacron\u4f1a\u5728\u673a\u5668\u5f00\u673a10\u5206\u949f\u4e4b\u540e\u8fd0\u884c\u4ed6\uff0c\u800c\u65e0\u9700\u5728\u7b49\u5f85\u4e0b\u4e00\u4e2a\u5468\u671f\u3002\n```\n\n\u5165\u4fb5\u6392\u67e5\uff1a\u91cd\u70b9\u5173\u6ce8\u4e00\u4e0b\u76ee\u5f55\u662f\u5426\u5b58\u5728\u6076\u610f\u811a\u672c\n\n```shell\n/var/spool/cron/* \n/etc/crontab\n/etc/cron.d/*\n/etc/cron.daily/* \n/etc/cron.hourly/* \n/etc/cron.monthly/*\n/etc/cron.weekly/\n/etc/anacrontab\n/var/spool/anacron/*\n```\n\n## 6.\u68c0\u67e5\u7cfb\u7edf\u670d\u52a1\n\n\u670d\u52a1\u81ea\u542f\u52a8\u4f7f\u7528chkconfig\n\n```shell\nchkconfig [--add][--del][--list][\u7cfb\u7edf\u670d\u52a1]\n--add \u589e\u52a0\u670d\u52a1\n--del \u5220\u9664\u670d\u52a1\nchkconfig --level httpd 2345 on \u8bbe\u7f6ehttpd\u5728\u8fd0\u884c\u7ea7\u522b2\u30013\u30014\u30015\u7684\u60c5\u51b5\u4e0b\u662fon(\u9ed8\u8ba42345)\n```\n\n\u670d\u52a1\u81ea\u542f\u52a8 \u4fee\u6539 /etc/re.d/rc.local \u6587\u4ef6 \n\n``` \n\u52a0\u5165 /etc/init.d/httpd start\n```\n\n\u6392\u67e5\n\n```shell\nchkconfig  --list  \t#\u67e5\u770b\u670d\u52a1\u81ea\u542f\u52a8\u72b6\u6001\nps aux | grep crond #\u67e5\u770b\u5f53\u524d\u670d\u52a1\n\u7cfb\u7edf\u57283\u4e0e5\u7ea7\u522b\u4e0b\u7684\u542f\u52a8\u9879 \n\u4e2d\u6587\u73af\u5883:chkconfig --list | grep \"3:\u542f\u7528\\|5:\u542f\u7528\"\n\u82f1\u6587\u73af\u5883:chkconfig --list | grep \"3:on\\|5:on\"\n\u67e5\u770b\u670d\u52a1\u5b89\u88c5\u4f4d\u7f6e \uff0c\u4e00\u822c\u662f\u5728/user/local/\nservice httpd start\n\u641c\u7d22/etc/rc.d/init.d/  \u67e5\u770b\u662f\u5426\u5b58\u5728\n```\n\n## 7.\u68c0\u67e5\u5f02\u5e38\u6587\u4ef6\n\n### 7.1 \u67e5\u770b\u654f\u611f\u76ee\u5f55\n\n+ \u5982/tmp\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\uff0c\u540c\u65f6\u6ce8\u610f\u9690\u85cf\u6587\u4ef6\u5939\uff0c\u4ee5\u201c..\u201d\u4e3a\u540d\u7684\u6587\u4ef6\u5939\u5177\u6709\u9690\u85cf\u5c5e\u6027\n\n### 7.2 \u5f97\u5230\u53d1\u73b0WEBSHELL\u3001\u8fdc\u63a7\u6728\u9a6c\u7684\u521b\u5efa\u65f6\u95f4\uff0c\u5982\u4f55\u627e\u51fa\u540c\u4e00\u65f6\u95f4\u8303\u56f4\u5185\u521b\u5efa\u7684\u6587\u4ef6\uff1f\n\n+ \u53ef\u4ee5\u4f7f\u7528find\u547d\u4ee4\u6765\u67e5\u627e\uff0c\u5982 find /opt -iname \"*\" -atime 1 -type f \u627e\u51fa /opt \u4e0b\u4e00\u5929\u524d\u8bbf\u95ee\u8fc7\u7684\u6587\u4ef6\n\n### 7.3 \u9488\u5bf9\u53ef\u7591\u6587\u4ef6\u53ef\u4ee5\u4f7f\u7528stat\u8fdb\u884c\u521b\u5efa\u4fee\u6539\u65f6\u95f4\n\n![image-20210719161637365](https://raw.githubusercontent.com/lixbao/PicGo/main/img/20210719161637.png)\n\n## 8.\u65e5\u5fd7\u5206\u6790\n\n>\u65e5\u5fd7\u9ed8\u8ba4\u5b58\u653e\u4f4d\u7f6e\uff1a /var/log\n>\n>\u67e5\u770b\u65e5\u5fd7\u914d\u7f6e\u60c5\u51b5\uff1a more /etc/rsyslog.conf\n\n![image-20210719161910258](https://raw.githubusercontent.com/lixbao/PicGo/main/img/20210719161910.png)\n\n### 8.1 \u5b9a\u4f4d\u6709\u591a\u5c11IP\u5728\u7206\u7834\u4e3b\u673a\u7684root\u5e10\u53f7\uff1a \n\n```shell\ngrep \"Failed password for root\" /var/log/secure | awk '{print $11}' | sort | uniq -c | sort -nr | more\n```\n\n### 8.2 \u653b\u51fb\u8005\u7206\u7834\u54ea\u4e9b\u7528\u6237\u540d\uff1f\n\n```shell\ngrep \"Failed password\" /var/log/secure|perl -e 'while($_=<>){ /for(.*?) from/; print \"$1\\n\";}'|uniq -c|sort -nr\n```\n\n### 8.3 \u767b\u5f55\u6210\u529f\u7684IP\u6709\u54ea\u4e9b\uff1f\n\n```shell\ngrep \"Accepted \" /var/log/secure | awk '{print $11}' | sort | uniq -c | sort -nr | more\n\n#\u767b\u5f55\u6210\u529f\u7684\u65e5\u671f\u3001\u7528\u6237\u540d\u3001IP\uff1a\ngrep \"Accepted \" /var/log/secure | awk '{print $1,$2,$3,$9,$11}' \n```\n\n### 8.4 \u7cfb\u7edf\u6dfb\u52a0\u3001\u5220\u9664\u7528\u6237\u7684\u8bb0\u5f55\u548c\u65f6\u95f4\n\n```shell\ngrep \"useradd\" /var/log/secure \n\ngrep \"userdel\" /var/log/secure\n```\n\n# Linux\u5165\u4fb5\u6392\u67e5\u5de5\u5177\u4ecb\u7ecd\n\nRootkit\u67e5\u6740\n\n+ Chkrootkit\uff1a\u7f51\u5740\uff1ahttp://www.chkrootkit.org\n\n+ Rkhunter\uff1a\u7f51\u5740\uff1ahttp://rkhunter.sourceforge.net\n\n\u75c5\u6bd2\u67e5\u6740\n\n+ Clamav\n\n+ ClamAV\u7684\u5b98\u65b9\u4e0b\u8f7d\u5730\u5740\u4e3a\uff1ahttp://www.clamav.net/download.html\n\nwebshell\u67e5\u6740linux\u7248\uff1a\n\n+ \u6cb3\u9a6cwebshell\u67e5\u6740\uff1ahttp://www.shellpub.com\n\n+ \u6df1\u4fe1\u670dWebshell\u7f51\u7ad9\u540e\u95e8\u68c0\u6d4b\u5de5\u5177\uff1ahttp://edr.sangfor.com.cn/backdoor_detection.html\n\nlinux\u5b89\u5168\u68c0\u67e5\u811a\u672c\n\n+ https://github.com/grayddq/GScan\n\n+ https://github.com/ppabc/security_check\n\n+ https://github.com/T0xst/linux\n\n"}